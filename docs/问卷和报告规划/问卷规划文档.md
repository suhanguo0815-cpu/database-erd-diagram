# 问卷规划文档

**文档创建时间**: 2025-01-06  
**文档版本**: v1.0  
**状态**: 📋 规划中

---

## 一、问卷概述

### 1.1 问卷目的
通过系统化的问卷收集，全面了解用户的健康状况、生活习惯、饮食偏好等信息，为后续的健康评估、个性化方案制定和报告生成提供数据基础。

### 1.2 问卷结构
问卷共包含 **78个题目**，分为以下11个部分：

1. **注册信息**（3题）
2. **基础信息**（3题）
3. **五因子评估**（20题）
4. **代谢疾病相关**（4题）
5. **女性健康信息**（7题）
6. **当前身体状态**（7题）
7. **健康状况**（4题）
8. **饮食习惯**（16题）
9. **运动与生活习惯**（7题）
10. **主观状态**（3题）
11. **减重行为与目标**（2题）

---

## 二、问卷模块详细规划

### 2.1 注册信息模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q1 | 微信昵称 | `nickname` | string | ✅ | 从微信授权获取 |
| Q2 | 手机号 | `phoneEncrypted` | string | ✅ | 加密存储 |
| Q3 | 是否已做测评 | `hasCompletedAssessment` | boolean | ❌ | 用于判断是否新用户 |

**数据来源**: 
- 微信授权API获取昵称
- 用户手动输入手机号（需验证码验证）

---

### 2.2 基础信息模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q4 | 性别 | `gender` | enum | ✅ | male/female |
| Q5 | 年龄 | `age` | integer | ✅ | 18-100岁 |
| Q6 | 身高 | `heightCm` | number | ✅ | 单位：厘米 |

**数据验证**:
- 年龄范围：18-100岁
- 身高范围：100-250cm

---

### 2.3 五因子评估模块

**评估维度**: 情绪因子、环境因子、认知因子、能动性因子、代谢因子

每个维度包含4个题目，共20题。

| 维度 | 题目数 | 字段名 | 存储位置 | 说明 |
|------|--------|--------|---------|------|
| 情绪因子 | 4题 | `rawResponsesJson` | `user_assessments` | JSON格式存储原始答案 |
| 环境因子 | 4题 | `rawResponsesJson` | `user_assessments` | JSON格式存储原始答案 |
| 认知因子 | 4题 | `rawResponsesJson` | `user_assessments` | JSON格式存储原始答案 |
| 能动性因子 | 4题 | `rawResponsesJson` | `user_assessments` | JSON格式存储原始答案 |
| 代谢因子 | 4题 | `rawResponsesJson` | `user_assessments` | JSON格式存储原始答案 |

**评分规则**: 
- 每个题目采用5分制（1-5分）
- 每个维度总分：4-20分
- 用于后续的健康风险评分和方案个性化

---

### 2.4 代谢疾病相关模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 说明 |
|---------|---------|--------|---------|------|
| Q27 | PCOS相关症状 | `healthConstraints.pcos` | JSON array | 多选：月经不规律、闭经、多毛、痤疮、不孕、已确诊 |
| Q28 | 确诊疾病 | `healthConstraints.diagnosed` | JSON array | 多选：甲状腺功能减退、糖尿病、PCOS、库欣综合征、其他代谢疾病 |
| Q29 | 甲减相关症状 | `healthConstraints.hypot` | JSON array | 多选：畏寒、水肿、皮肤干燥、疲劳、已确诊 |
| Q30 | 库欣综合征症状 | `healthConstraints.cushing` | JSON array | 多选：满月脸、水牛背、腹部紫纹、高血压、已确诊 |

**数据存储**: `user_assessments.healthConstraints` (JSON格式)

---

### 2.5 女性健康信息模块（仅女性用户）

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q31 | 月经是否规律 | `menstrualRegular` | enum | ❌ | regular/irregular/menopause |
| Q32 | 是否痛经 | `hasDysmenorrhea` | boolean | ❌ | true/false |
| Q33 | 月经周期天数 | `menstrualCycleDays` | integer | ❌ | 21-35天 |
| Q34 | 是否已生育 | `hasGivenBirth` | boolean | ❌ | true/false |
| Q35 | 产后时间（月） | `postpartumMonths` | integer | ❌ | 仅当Q34=true时显示 |
| Q36 | 是否在哺乳期 | `isBreastfeeding` | boolean | ❌ | true/false |
| Q37 | 喂养方式 | `feedingMethod` | enum | ❌ | breast/mixed/formula |

**显示逻辑**: 仅当 `gender=female` 时显示此模块

---

### 2.6 当前身体状态模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q38 | 当前体重 | `initialWeightKg` | number | ✅ | 单位：kg |
| Q39 | 当前腰围 | `waistCircumferenceCm` | number | ❌ | 单位：cm |
| Q40 | 当前臀围 | `hipCircumferenceCm` | number | ❌ | 单位：cm |
| Q41 | 历史最高体重 | `maxWeightKg` | number | ❌ | 单位：kg |
| Q42 | 历史最低体重 | `minWeightKg` | number | ❌ | 单位：kg |
| Q43 | 目标体重 | `targetWeightKg` | number | ✅ | 单位：kg，存储到 `user_goals` |
| Q44 | 减重周期 | `goalCycleDays` | integer | ✅ | 单位：天，存储到 `user_goals` |

**数据验证**:
- 体重范围：30-200kg
- 腰围范围：50-200cm
- 目标体重应 < 当前体重（减重场景）

---

### 2.7 健康状况模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q45 | 慢性疾病 | `chronicDiseases` | JSON array | ❌ | 多选：高血压、高血脂、糖尿病等 |
| Q46 | 用药情况 | `medications` | JSON array | ❌ | 多选：降压药、降糖药等 |
| Q47 | 过敏/忌口食物 | `allergies` | JSON array | ❌ | 多选或自由文本 |
| Q48 | 饮食限制/偏好 | `dietaryRestrictions` | JSON array | ❌ | 多选：素食、低盐、低脂等 |

---

### 2.8 饮食习惯模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q49 | 饮食模式 | `dietPattern` | enum | ✅ | three_meals/small_frequent/intermittent/irregular/other |
| Q50 | 餐食安排方式 | `mealArrangement` | enum | ✅ | self_cook/delivery/canteen/mixed/other |
| Q51 | 全谷和薯类占比 | `wholeGrainRatio` | boolean | ❌ | 是否占主食40%以上 |
| Q52 | 豆类频率 | `legumeFrequency` | enum | ❌ | never/weekly_1_2/weekly_3_4/weekly_5_6/daily |
| Q53 | 每日奶制品摄入量 | `dairyIntakeMl` | enum | ❌ | none/100_200/200_300/300_500/over_500 |
| Q54 | 肝脏摄入频率 | `liverIntakeFrequency` | enum | ❌ | never/monthly_1_2/weekly_1_2 |
| Q55 | 蔬菜水果摄入量 | `fruitVegetableIntake` | enum | ❌ | over_500/300_500/200_300/under_200/rare |
| Q56 | 饮食习惯 | `dietaryHabits` | enum | ✅ | regular/vegetarian_lacto/vegetarian_strict/other |
| Q57 | 其他饮食偏好 | `dietaryHabitsOther` | string | ❌ | 自由文本 |
| Q58 | 深海鱼频率 | `deepSeaFishFrequency` | boolean | ❌ | 每周是否能吃1-2次 |
| Q59 | 口味偏好 | `tastePreference` | enum | ✅ | light/moderate/salty/sweet/spicy/oily |
| Q60 | 每日饮水量 | `dailyWaterIntakeMl` | enum | ❌ | under_1000/1000_1500/1500_2000/over_2000 |
| Q61 | 饮酒频率 | `alcoholFrequency` | enum | ❌ | none/monthly_1_2/weekly_1_2/weekly_over_3 |
| Q62 | 营养素补剂类型 | `supplementTypes` | JSON array | ❌ | 多选：维生素D、钙、铁等 |

---

### 2.9 运动与生活习惯模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q63 | 职业相关体力活动水平 | `occupationalActivityLevel` | enum | ✅ | sedentary/light/moderate/heavy |
| Q64 | 每周运动天数 | `exerciseDaysPerWeek` | enum | ✅ | none/1_2/3_4/5_6/daily |
| Q65 | 每次运动时长 | `exerciseDurationMinutes` | enum | ✅ | none/under_30/30_60/60_90/over_90 |
| Q66 | 运动偏好 | `exercisePreferences` | JSON array | ❌ | 多选：有氧、力量、瑜伽等 |
| Q67 | 每日日晒时间 | `sunExposureMinutes` | enum | ❌ | none/10_20/20_30/30_60/over_60 |
| Q68 | 睡眠时长 | `sleepDuration` | integer | ❌ | 单位：小时，已存在字段 |
| Q69 | 排便情况 | `bowelHabits` | enum | ❌ | normal/constipation/diarrhea/irregular |

---

### 2.10 主观状态模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q70 | 自评身体状态 | `selfPerceivedHealthStatus` | enum | ✅ | excellent/good/fair/poor/very_poor |
| Q71 | 头晕乏力频率 | `dizzinessFatigueFrequency` | enum | ❌ | never/occasional/frequent/always |
| Q72 | 熬夜频率 | `stayingUpLateFrequency` | enum | ❌ | never/occasional/weekly_3_4/daily |
| Q73 | 口腔溃疡频率 | `oralUlcerFrequency` | enum | ❌ | never/occasional/frequent |

---

### 2.11 减重行为与目标模块

| 题目序号 | 题目内容 | 字段名 | 数据类型 | 必填 | 说明 |
|---------|---------|--------|---------|------|------|
| Q74 | 体重上涨原因 | `weightGainReasons` | JSON array | ❌ | 多选：饮食不规律、缺乏运动等 |
| Q75 | 过去减重行为 | `pastWeightLossBehaviors` | JSON array | ❌ | 多选：极端节食、减肥药等 |
| Q76 | 最希望改善的方面 | `improvementGoals` | JSON array | ✅ | 多选，最多3个：减重、体型、健康指标等 |

---

## 三、问卷流程设计

### 3.1 页面跳转逻辑

```
登录页面 → 问卷首页
  ↓
基础信息（Q4-Q6）
  ↓
五因子评估（Q7-Q26，分5个页面，每页4题）
  ↓
代谢疾病（Q27-Q30）
  ↓
女性健康（Q31-Q37，仅女性显示）
  ↓
身体状态（Q38-Q44）
  ↓
健康状况（Q45-Q48）
  ↓
饮食习惯（Q49-Q62，分2-3页）
  ↓
运动习惯（Q63-Q69）
  ↓
主观状态（Q70-Q73）
  ↓
减重目标（Q74-Q76）
  ↓
提交确认 → 生成报告
```

### 3.2 进度提示
- 顶部显示进度条：已完成题目数 / 总题目数
- 支持返回上一题修改
- 支持暂存功能（localStorage）

### 3.3 数据验证
- **前端验证**: 必填项检查、数据格式验证、数值范围检查
- **后端验证**: 数据完整性、业务逻辑验证、数据一致性检查

---

## 四、数据存储方案

### 4.1 存储位置

| 数据类型 | 存储表 | 说明 |
|---------|--------|------|
| 基础信息 | `user_core` | 用户核心信息 |
| 五因子评估原始数据 | `user_assessments.rawResponsesJson` | JSON格式存储 |
| 代谢疾病信息 | `user_assessments.healthConstraints` | JSON格式存储 |
| 问卷新增字段 | `user_core` | 约30个新增字段 |
| 目标信息 | `user_goals` | 目标体重、减重周期 |

### 4.2 字段优先级

**P0 优先级（核心字段，必须）**:
- 身体测量：腰围、臀围、历史体重
- 女性健康：月经规律、是否生育、是否哺乳
- 饮食习惯核心：饮食模式、餐食安排、饮食习惯、口味偏好
- 运动核心：职业活动水平、运动频率、运动时长
- 主观状态核心：自评身体状态、改善目标

**P1 优先级（重要字段）**:
- 女性健康详细、饮食习惯详细、生活习惯、减重行为

**P2 优先级（可选字段）**:
- 饮食习惯补充、主观状态补充、运动偏好详细

---

## 五、问卷优化建议

### 5.1 用户体验优化
- [ ] 添加题目说明和示例
- [ ] 支持跳过非必填项
- [ ] 添加智能提示（如根据BMI推荐目标体重）
- [ ] 优化移动端交互（滑动切换、大按钮）

### 5.2 数据质量优化
- [ ] 添加逻辑校验（如目标体重应小于当前体重）
- [ ] 添加异常值检测（如身高200cm需二次确认）
- [ ] 支持数据修正功能（完成问卷后可修改）

### 5.3 性能优化
- [ ] 分页加载，减少单页题目数量
- [ ] 使用localStorage暂存，防止数据丢失
- [ ] 优化提交逻辑，支持断点续传

---

## 六、后续规划

### 6.1 问卷版本管理
- 支持问卷版本迭代
- 记录问卷完成时间 `questionnaireCompletedAtUtc`
- 支持重新填写问卷（覆盖或新增版本）

### 6.2 问卷数据分析
- 统计各题目填写率
- 分析用户填写习惯
- 优化题目顺序和内容

### 6.3 问卷与报告联动
- 问卷数据作为报告生成的基础
- 根据问卷结果个性化报告内容
- 问卷数据用于补剂推荐和健康风险评分

---

## 七、参考资料

- [问卷字段规划方案](../数据库设计/问卷字段规划方案.md)
- [数据库表字段清单](../数据库设计/数据库表字段清单_最新版.csv)
- [用户健康档案字段建议](../数据库设计/用户健康档案字段建议.md)

