# 小程序功能模块规划

## 一、核心流程模块

### 1.1 身份激活模块
- **功能**：微信号一键登录
- **页面**：登录/注册页面（全新设计）
- **逻辑**：微信授权 → 自动识别付费状态 → 解锁会员权限

### 1.2 深度评估模块
- **功能**：全量深度问卷（全新设计）
- **页面**：问卷填写页面
- **内容**：病史、过敏原、生活习惯等全量信息采集
- **逻辑**：分段引导 → 支持中途保存 → 提交后触发方案生成

### 1.3 方案定制模块（服务预热仪式）
- **功能**：将等待期转化为实时计算中"
- **页面**：方案生成中页面
- **核心设计**：
  - **实时解析动效**：文字流显示计算进度（"正在分析您的过敏史..."、"正在匹配 211 饮食比例..."、"正在生成终身抗炎路径..."）
  - **偏好采集集成**：将提醒设置、性格设置无缝嵌入等待过程，让用户感觉"我在优化我的 AI"而非"我在干等"
- **逻辑**：提交问卷后触发 → 5-10分钟等待期（转化为服务预热仪式） → 支持退出（后台通知）

### 1.4 服务开启模块
- **功能**：查看报告并添加营养师微信二维码
- **页面**：深度定制方案报告页
- **逻辑**：查看报告 → 添加营养师微信二维码

---

## 二、主要功能模块

### 2.1 今日模块（首页重构 - 信息层级优化）
- **设计原则**：首页看状态，目标页看深度
- **核心内容**（极简设计）：
  - **健康风险评分**（核心指标，置顶展示）：
    - **总分展示**：10分制综合评分，大号数字+环形进度图
    - **四个维度**（权重分配）：
      - 抗炎指数：55%（5.5分）- 最高权重
      - 营养素指数：25%（2.5分）
      - 热量平衡：12%（1.2分）
      - BMI风险评分：8%（0.8分）
    - **展示方式**：总分卡片 + 四个维度横向进度条（可折叠/展开）
    - **交互设计**：点击总分卡片可展开查看四个维度详情，点击维度可查看该维度详细说明
  - **211饮食结构图**：当天蔬菜(50%)、主食(25%)、蛋白(25%)饼图
  - **热量缺口**：剩余卡路里显示
  - **关键指标**：体重数值、变化
- **信息层级**：
  - **第一层**：健康风险评分（最核心，视觉最突出）
  - **第二层**：211饮食结构图、热量缺口、体重指标
- **交互设计**：
  - 健康风险评分支持展开/收起四个维度详情
  

### 2.2 目标模块（进度追踪 - 深度数据展示）
- **累计统计看板**：本周/本月汇总
  - **本周汇总数据**：
    - 健康风险评分平均值（对比今日评分）
    - 累计摄入热量均值（卡路里）
    - 211饮食结构达标天数（如：5/7天达标）
    - 抗炎指数平均值
    - 营养素指数平均值
    - 热量平衡达标天数
    - 体重变化趋势（本周起始体重 vs 当前体重）
  - **本月汇总数据**：
    - 健康风险评分趋势（折线图）
    - 累计摄入热量均值（卡路里）
    - 211饮食结构达标率（如：18/30天达标，60%）
    - 抗炎指数平均值及趋势
    - 营养素指数平均值及趋势
    - 热量平衡达标率
    - 体重变化总量（本月起始体重 vs 当前体重）
    - 连续打卡天数
  - **展示方式**：Tab切换（本周/本月），卡片式布局，关键指标突出显示
- **微量元素雷达图**：镁/锌/钾/钠等关键矿物质达标情况（长期累计观察，适合放在目标页）
- **补剂计划单**：品种、剂量、频次、服用提醒（只读展示）
- **周报复盘入口**：本周分析报告、MVP餐食（红榜餐食）展示
- **体重趋势图表**：历史体重变化曲线
- **本周任务卡片**：纵向排列，显示✅/🔲状态（AI自动勾选）（二期功能）

### 2.3 百科模块（内容驱动模式 - 替换原社区）
- **设计理念**：从"货架"转变为"百科中心"，采用内容驱动模式
- **核心功能**：
  - **抗炎百科**：作为主要入口，展示抗炎红黑榜、食材避坑指南（跳转有赞）
  - **关联商品展示**：当用户查看"抗炎补剂百科"时，下方自然滑出相关的"明星补剂"商品卡片
  - **我的课程**：展示已购买的抗炎/减脂课程（跳转有赞）
- **UI设计**：
  - 使用小程序内浮窗卡片展示商品摘要
  - 用户确认购买意向后跳转有赞，保持品牌体验的连续性
  - 降低商业目的性，提高信任感

### 2.4 我的模块（个人中心）
- **我的营养师**：专属营养师/AI文慧企微二维码（已认证/待添加）
- **健康档案库**：用户健康档案信息
- **服务偏好设置**：提醒时段、提醒频次（体重/喝水/三餐/运动提醒）
- **订单管理**：我的订单（跳转有赞）
- **体检报告**：上传和管理体检报告记录
- **个人账号信息**：账号设置、退出登录

---

## 三、数据镜像模块

### 3.1 AI数据同步
- **群内数据识别**：实时识别微信群内餐食数据
- **数据自动同步**：直接关联数据库，实时更新小程序看板
- **镜像看板激活**：服务开启后，补剂计划、身体档案实时镜像到小程序

### 3.2 提醒功能模块
- **体重打卡提醒**：根据用户设置时段提醒
- **喝水提醒**：根据用户设置时段提醒
- **三餐提醒**：根据用户设置时段提醒
- **运动提醒**：根据用户设置时段提醒
- **补剂服用提醒**：根据补剂计划单自动提醒
- **实时生效**：服务偏好修改后立即生效

---

## 四、第三方集成模块

### 4.1 有赞系统集成（建议方案）
- **小程序跳转**：使用 `wx.navigateToMiniProgram` API跳转到有赞小程序
- **课程展示**：小程序内展示课程列表，点击跳转有赞查看详情和学习
- **商城交易**：小程序内展示商品，点击跳转有赞完成支付下单
- **订单同步**：有赞订单状态回传小程序，在"我的订单"中展示

### 4.2 企业微信集成
- **群聊跳转**：查看报告后跳转到企业微信群
- **二维码展示**：在"我的营养师"页面展示企微二维码

---

## 五、页面架构

### 5.1 底部导航栏（动态感知模式 - 4个Tab）
1. **今日 (Today)**：核心入口，服务开启前显示"进度条"，开启后显示"看板"
2. **计划 (Plan)**：将原"目标"改为"计划"，更强调终身健康管理的仪式感（进度追踪、补剂计划、周报）
3. **百科 (Library)**：将"商城"改为"百科"，降低商业目的性，提高信任感（课程、百科、商品）
4. **我的 (Me)**：个人中心、设置、档案

### 5.2 页面层级
- **一级页面**：今日、计划、百科、我的（底部导航）
- **二级页面**：问卷填写、方案报告、健康档案、服务偏好、订单管理、体检报告、课程详情、商品详情等
- **三级页面**：营养素详情、周报详情、任务详情等

---

## 六、功能模块清单

### 核心流程（4个模块）
1. ✅ 身份激活模块
2. ✅ 深度评估模块
3. ✅ 方案定制模块
4. ✅ 服务开启模块

### 主要功能（4个模块）
5. ✅ 今日模块（信息层级优化）
6. ✅ 计划模块（原目标模块，深度数据展示）
7. ✅ 百科模块（原商城模块，内容驱动模式）
8. ✅ 我的模块

### 数据与提醒（2个模块）
9. ✅ AI数据同步模块
10. ✅ 提醒功能模块

### 第三方集成（2个模块）
11. ✅ 有赞系统集成模块
12. ✅ 企业微信集成模块

---

## 七、待讨论事项（已优化）

### 7.1 营养素详细数据位置 ✅ 已确定
- **方案**：分层展示
  - **今日模块**：只展示宏量营养素（碳水/蛋白质/脂肪），通过点击211饼图弹窗显示
  - **目标模块**：展示微量元素雷达图（镁/锌/钾/钠等），适合长期累计观察
- **理由**：避免首页过于臃肿，符合30-45岁女性"抓重点"的使用习惯

### 7.2 有赞集成细节 ✅ 已确定
- **方案**：静默关联
  - 通过手机号同步订单，在"我的"页面仅展示订单状态及售后入口
  - 用户不需要在小程序内看到复杂的订单流，只需确认"服务已买"
- **实现**：订单数据回传范围限定为订单状态、售后入口；课程学习进度暂不同步

### 7.3 周报MVP餐食评选标准 ✅ 已确定
- **方案**："色香味"+"结构"双优标准
  - AI识别211结构达标且食材多样性最高的一餐
  - 红榜餐食应具备社交分享属性，激励用户更用心地打卡

### 7.4 数据同步失败处理 ✅ 已确定
- **方案**："异步补记"机制
  - 若AI识别失败，推送一条"文慧没看懂这张餐图"的消息，引导手动补录
  - 保持数据连续性，减少用户因为技术故障产生的挫败感

---

## 八、开发优先级建议

### P0（核心功能，必须实现）
- 身份激活（微信号登录）
- 深度评估（问卷）
- 方案定制（生成等待）
- 服务开启（报告查看）
- 今日模块（健康风险评分、基础数据展示）
- 我的模块（基础功能）

### P1（重要功能，优先实现）
- 计划模块（补剂计划、周报、累计统计看板）
- 提醒功能（各类提醒）
- AI数据同步（群内数据识别）

### P2（增强功能，后续实现）
- 百科模块（课程、百科、商品）
- 有赞系统集成（完整跳转和订单同步）
- 微量元素雷达图展示
- 本周任务卡片（AI自动勾选功能）

---

## 九、健康风险评分指标详细设计

### 9.1 评分体系
- **总分**：10分制
- **四个维度权重分配**：
  - 抗炎指数：55%（5.5分）- 最高权重，核心指标
  - 营养素指数：25%（2.5分）
  - 热量平衡：12%（1.2分）
  - BMI风险评分：8%（0.8分）
- **计算公式**：总分 = 抗炎指数×0.55 + 营养素指数×0.25 + 热量平衡×0.12 + BMI风险评分×0.08

### 9.2 UI设计建议
- **总分卡片**（置顶，最显眼）：
  - 大号数字显示总分（如：8.5/10）
  - 环形进度图展示完成度
  - 颜色编码：8-10分（绿色）、6-8分（黄色）、<6分（红色）
  - 支持点击展开/收起四个维度详情
- **四个维度展示**（可折叠）：
  - 横向进度条展示每个维度得分
  - 显示维度名称、得分、权重百分比
  - 颜色编码与总分保持一致
  - 点击维度可查看该维度详细说明和改善建议

### 9.3 数据来源
- **抗炎指数**（55%）：基于群内餐食识别，分析抗炎食材比例、炎症性食物摄入等
- **营养素指数**（25%）：基于三大宏量营养素和关键矿物质（镁/锌/钾/钠）达标情况
- **热量平衡**（12%）：基于剩余卡路里、摄入与消耗平衡度
- **BMI风险评分**（8%）：基于当前BMI值，评估健康风险等级

### 9.4 更新频率
- **实时更新**：每日数据变化后实时计算更新
- **历史趋势**：在计划模块展示历史评分趋势图

### 9.5 交互设计
- **默认状态**：显示总分和环形进度图，四个维度折叠
- **展开状态**：点击总分卡片展开四个维度详情
- **详情查看**：点击单个维度可跳转到该维度的详细分析页面（二级页面）

---

## 十、技术实现要点

1. **微信登录**：使用 `wx.login()` + `wx.getUserInfo()` 获取用户信息
2. **数据同步**：通过后端API实时同步群内识别数据
3. **提醒功能**：使用小程序订阅消息API + 本地通知
4. **有赞跳转**：使用 `wx.navigateToMiniProgram` 跳转有赞小程序
5. **数据存储**：本地缓存 + 云端数据库同步
6. **健康风险评分计算**：后端实时计算四个维度得分，前端展示总分和维度详情


