# 数据库表结构和字段清单更新说明

## 一、更新日期
2024年（最新版本）

## 二、更新内容

### 1. `user_core` 表新增字段（16个）

#### 1.1 存量字段（3个 - P0优先级）
| 字段名 | 类型 | 说明 | 字段内容示例 |
|--------|------|------|------------|
| `age` | int | 用户年龄 | `28` |
| `heightCm` | num | 用户身高（厘米） | `170.0` |
| `initialWeightKg` | num | 用户初始体重（kg） | `68.5` |

#### 1.2 健康档案核心字段（4个 - P0优先级）
| 字段名 | 类型 | 说明 | 字段内容示例 |
|--------|------|------|------------|
| `bmi` | num | 身体质量指数 | `24.5` |
| `allergies` | json | 过敏史（食物过敏列表） | `["海鲜", "花生", "牛奶"]` |
| `chronicDiseases` | json | 慢性疾病列表 | `["糖尿病", "高血压"]` |
| `medications` | json | 用药情况（当前用药列表） | `[{"name": "降糖药", "dosage": "每日2次", "note": "餐后服用"}]` |

#### 1.3 健康档案重要字段（6个 - P1优先级）
| 字段名 | 类型 | 说明 | 字段内容示例 |
|--------|------|------|------------|
| `occupation` | str | 职业 | `"互联网产品经理"` |
| `bmr` | num | 基础代谢率（千卡/天） | `1450.5` |
| `pal` | num | PAL系数（身体活动水平，1.2-2.5） | `1.6` |
| `exerciseHabits` | str | 运动习惯描述（自由文本） | `"每周3-4次，每次30-60分钟"` |
| `exerciseFrequency` | str | 运动频率（枚举） | `weekly_3_4` |
| `workRhythm` | str | 工作节奏（枚举） | `regular_9_6` |

#### 1.4 健康档案可选字段（3个 - P2优先级）
| 字段名 | 类型 | 说明 | 字段内容示例 |
|--------|------|------|------------|
| `familyHistory` | json | 家族病史 | `["糖尿病", "心脏病"]` |
| `dietaryRestrictions` | json | 饮食限制/偏好 | `["素食", "低盐", "无麸质"]` |
| `sleepDuration` | int | 平均睡眠时长（小时） | `7` |

---

## 三、表结构说明

### `user_core` 表（更新后）
- **字段总数**：34个字段（原有18个 + 新增16个）
- **表关系**：一对一关系（每个用户一条记录）
- **业务定位**：用户基础信息和健康档案

### `user_assessments` 表（保持不变）
- **字段总数**：20个字段
- **表关系**：一对多关系（支持版本化）
- **业务定位**：健康评估/人格画像的测评结果
- **关系**：通过 `userId` 关联 `user_core`，但保持独立

---

## 四、字段分类汇总

### 按优先级分类

#### P0优先级（核心字段 - 必须）
- **存量字段**：`age`、`heightCm`、`initialWeightKg`
- **健康档案核心**：`bmi`、`allergies`、`chronicDiseases`、`medications`
- **总计**：7个字段

#### P1优先级（重要字段 - 建议）
- **健康档案重要**：`occupation`、`bmr`、`pal`、`exerciseHabits`、`exerciseFrequency`、`workRhythm`
- **总计**：6个字段

#### P2优先级（可选字段 - 按需）
- **健康档案可选**：`familyHistory`、`dietaryRestrictions`、`sleepDuration`
- **总计**：3个字段

---

## 五、字段约束说明

### JSON字段格式

#### `allergies`（过敏史）
```json
["海鲜", "花生", "牛奶"]
```

#### `chronicDiseases`（慢性疾病）
```json
["糖尿病", "高血压"]
```

#### `medications`（用药情况）
```json
[
  {
    "name": "降糖药",
    "dosage": "每日2次",
    "note": "餐后服用"
  }
]
```

#### `familyHistory`（家族病史）
```json
["糖尿病", "心脏病"]
```

#### `dietaryRestrictions`（饮食限制/偏好）
```json
["素食", "低盐", "无麸质"]
```

### 枚举字段格式

#### `exerciseFrequency`（运动频率）
- `none` - 不运动
- `daily` - 每天
- `weekly_3_4` - 每周3-4次
- `weekly_1_2` - 每周1-2次
- `irregular` - 不规律

#### `workRhythm`（工作节奏）
- `regular_9_6` - 规律9-6点
- `shift` - 轮班制
- `irregular` - 不规律
- `freelance` - 自由职业

---

## 六、实施建议

### 阶段1：P0优先级字段（立即实施）
1. 存量字段迁移：`age`、`heightCm`、`initialWeightKg`
2. 健康档案核心字段：`bmi`、`allergies`、`chronicDiseases`、`medications`

### 阶段2：P1优先级字段（后续补充）
健康档案重要字段：`occupation`、`bmr`、`pal`、`exerciseHabits`、`exerciseFrequency`、`workRhythm`

### 阶段3：P2优先级字段（按需添加）
健康档案可选字段：`familyHistory`、`dietaryRestrictions`、`sleepDuration`

---

## 七、数据迁移注意事项

### 存量数据迁移
1. **`age`、`heightCm`、`initialWeightKg`**：从存量表迁移到 `user_core` 表
2. **`weight_kg`**：迁移到 `user_core.initialWeightKg` 作为用户初始体重

### 新字段初始化
- 所有新字段默认可以为 `NULL`
- JSON字段初始化为空数组 `[]` 或空对象 `{}`
- 枚举字段需要在应用层进行验证

---

## 八、表关系图更新

```
user_core (用户基础信息 + 健康档案)
    │
    ├── 1:1 → user_preferences (用户偏好)
    ├── 1:N → user_goals (用户目标，版本化)
    ├── 1:N → user_assessments (健康评估，版本化) ⭐ 保持独立
    └── 1:N → 所有业务事实表（meals, weight, exercise等）
```

---

## 九、字段清单文件

**文件路径**：`数据库表字段清单_最新版.csv`

**更新内容**：
- ✅ 添加了 `user_core` 表的16个新字段
- ✅ 所有字段都包含完整的字段内容示例
- ✅ 按优先级分类（P0、P1、P2）

---

## 十、总结

### 更新统计
- **`user_core` 表**：新增16个字段
  - 存量字段：3个（P0）
  - 健康档案核心：4个（P0）
  - 健康档案重要：6个（P1）
  - 健康档案可选：3个（P2）

- **`user_assessments` 表**：保持不变，保持独立

### 设计优势
1. ✅ **简化设计**：健康档案信息集中在 `user_core` 表，查询方便
2. ✅ **版本保留**：`user_assessments` 保持独立，支持版本历史
3. ✅ **清晰分离**：基础档案与评估结果分离，逻辑清晰
4. ✅ **扩展性好**：通过优先级分层，便于分阶段实施


