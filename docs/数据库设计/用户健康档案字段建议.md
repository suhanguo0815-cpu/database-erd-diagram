# 用户健康档案字段建议

## 一、当前字段分析

### 已有字段（user_core表）
- ✅ `nickname`（姓名）
- ✅ `gender`（性别）
- ✅ `age`（年龄）
- ✅ `heightCm`（身高）
- ✅ `initialWeightKg`（初始体重）

### 前端页面已有但数据库缺失的字段
根据 `health-profile.html` 页面显示：
- ❌ `allergy`（过敏史）
- ❌ `disease`（慢性疾病）
- ❌ `exercise`（运动习惯）
- ❌ `work`（工作节奏）
- ❌ `BMI`（身体质量指数，可计算但建议存储）

### Java后台有但当前数据库缺失的字段
- ❌ `occupation`（职业）
- ❌ `bmr`（基础代谢率）
- ❌ `pal`（PAL系数，身体活动水平）
- ❌ `daily_calorie`（每日所需能量）

---

## 二、字段建议方案

### 方案1：在 `user_core` 表新增基础字段（P0优先级）

**建议新增字段**：

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 示例 | 优先级 |
|--------|------|------|----------|------|------|--------|
| `occupation` | str | 100 | ❌ | 职业 | `"互联网产品经理"` | P1 |
| `bmi` | num | 53 | ❌ | 身体质量指数（可计算，建议存储） | `24.5` | P0 |
| `bmr` | num | 53 | ❌ | 基础代谢率（千卡/天） | `1450.5` | P1 |
| `pal` | num | 53 | ❌ | PAL系数（身体活动水平，1.2-2.5） | `1.6` | P1 |

**说明**：
- `bmi`：虽然可以计算，但存储后便于快速查询和统计
- `occupation`、`bmr`、`pal`：这些是用户的基础属性，放在 `user_core` 表合理

---

### 方案2：新建 `user_health_profile` 表（健康档案详细表）

**表名**：`user_health_profile`

**业务定位**：存储用户健康档案的详细信息，支持个性化营养建议

**字段设计**：

| 字段名 | 类型 | 长度 | 是否非空 | 主键 | 说明 | 字段内容示例 | 优先级 |
|--------|------|------|----------|------|------|------------|--------|
| `profileId` | str | uuid | ✅ | ✅ | 健康档案ID（主键） | `"profile-550e8400-e29b-41d4-a716-446655440000"` | P0 |
| `userId` | str | uuid | ✅ | ❌ | 用户ID（关联user_core.userId） | `"550e8400-e29b-41d4-a716-446655440000"` | P0 |
| `version` | int | 32 | ✅ | ✅ | 版本号（联合主键：userId+version） | `1` | P0 |
| `allergies` | json | - | ❌ | ❌ | 过敏史（食物过敏列表） | `["海鲜", "花生", "牛奶"]` | P0 |
| `chronicDiseases` | json | - | ❌ | ❌ | 慢性疾病列表 | `["糖尿病", "高血压"]` | P0 |
| `medications` | json | - | ❌ | ❌ | 用药情况（当前用药列表） | `[{"name": "降糖药", "dosage": "每日2次", "note": "餐后服用"}]` | P1 |
| `exerciseHabits` | str | 100 | ❌ | ❌ | 运动习惯描述 | `"每周3-4次，每次30-60分钟"` | P0 |
| `exerciseFrequency` | str | 20 | ❌ | ❌ | 运动频率（枚举） | `weekly_3_4` | P0 |
| `exerciseDuration` | int | 32 | ❌ | ❌ | 单次运动时长（分钟） | `45` | P0 |
| `exerciseTypes` | json | - | ❌ | ❌ | 运动类型列表 | `["running", "yoga", "cycling"]` | P1 |
| `workRhythm` | str | 50 | ❌ | ❌ | 工作节奏 | `regular_9_6` | P0 |
| `workSchedule` | json | - | ❌ | ❌ | 工作时间安排 | `{"startTime": "09:00", "endTime": "18:00", "hasLunchBreak": true}` | P1 |
| `sleepDuration` | int | 32 | ❌ | ❌ | 平均睡眠时长（小时） | `7` | P1 |
| `smokingStatus` | str | 20 | ❌ | ❌ | 吸烟状态 | `never/former/current` | P1 |
| `alcoholFrequency` | str | 20 | ❌ | ❌ | 饮酒频率 | `never/occasional/regular` | P1 |
| `familyHistory` | json | - | ❌ | ❌ | 家族病史 | `["糖尿病", "心脏病"]` | P1 |
| `pregnancyStatus` | str | 20 | ❌ | ❌ | 生育状态（女性专用） | `not_pregnant/pregnant/lactating` | P1 |
| `menstrualCycle` | json | - | ❌ | ❌ | 月经周期（女性专用） | `{"length": 28, "duration": 5, "lastPeriod": "2024-01-01"}` | P2 |
| `waistCircumference` | num | 53 | ❌ | ❌ | 腰围（cm） | `75.5` | P2 |
| `bodyFatPercentage` | num | 53 | ❌ | ❌ | 体脂率（%） | `22.5` | P2 |
| `bloodPressure` | json | - | ❌ | ❌ | 血压 | `{"systolic": 120, "diastolic": 80}` | P2 |
| `bloodSugar` | json | - | ❌ | ❌ | 血糖 | `{"fasting": 5.5, "unit": "mmol/L"}` | P2 |
| `dailyCalorieNeed` | int | 32 | ❌ | ❌ | 每日所需能量（千卡，计算值） | `1800` | P1 |
| `dietaryRestrictions` | json | - | ❌ | ❌ | 饮食限制/偏好 | `["素食", "低盐", "无麸质"]` | P1 |
| `foodPreferences` | json | - | ❌ | ❌ | 食物偏好 | `["川菜", "海鲜", "水果"]` | P2 |
| `notes` | text | - | ❌ | ❌ | 备注 | `"对海鲜过敏，建议避免"` | P1 |
| `isCurrent` | bool | - | ✅ | ❌ | 是否当前档案（唯一约束：userId+isCurrent where isCurrent=true） | `true` | P0 |
| `create_time` | timestamp | 6 | ❌ | ❌ | 创建时间（UTC） | `2024-01-15T10:00:00Z` | P0 |
| `update_time` | timestamp | 6 | ❌ | ❌ | 更新时间（UTC） | `2024-01-15T10:00:00Z` | P0 |

**设计说明**：
1. **版本化设计**：使用 `userId + version` 作为联合主键，支持用户多次更新健康档案
2. **当前档案标识**：使用 `isCurrent` 字段标识当前生效的档案
3. **JSON字段**：过敏、疾病、用药等使用JSON数组，便于扩展和查询
4. **女性特殊字段**：`pregnancyStatus` 和 `menstrualCycle` 仅在 `gender=female` 时使用
5. **优先级分层**：
   - **P0**：核心字段，必须支持
   - **P1**：重要字段，建议支持
   - **P2**：可选字段，根据业务需求决定

---

## 三、字段优先级建议

### P0（最高优先级）- 核心字段
1. **过敏史**（`allergies`）：食物过敏直接影响营养建议，必须
2. **慢性疾病**（`chronicDiseases`）：影响饮食方案和禁忌
3. **运动习惯**（`exerciseHabits`、`exerciseFrequency`）：用于计算每日能量需求
4. **工作节奏**（`workRhythm`）：影响进餐时间和生活方式建议
5. **BMI**（`user_core.bmi`）：基础健康指标

### P1（中等优先级）- 重要字段
1. **用药情况**（`medications`）：可能与食物相互作用
2. **基础代谢率**（`user_core.bmr`）：用于计算能量需求
3. **PAL系数**（`user_core.pal`）：用于计算能量需求
4. **每日所需能量**（`dailyCalorieNeed`）：综合计算结果
5. **饮食限制**（`dietaryRestrictions`）：影响饮食建议
6. **睡眠时长**（`sleepDuration`）：影响代谢和健康
7. **家族病史**（`familyHistory`）：用于风险评估

### P2（低优先级）- 可选字段
1. **生育状态**（`pregnancyStatus`）：女性专用
2. **月经周期**（`menstrualCycle`）：女性专用
3. **腰围**（`waistCircumference`）：体脂分布指标
4. **体脂率**（`bodyFatPercentage`）：需要专业设备测量
5. **血压/血糖**（`bloodPressure`、`bloodSugar`）：体检指标
6. **食物偏好**（`foodPreferences`）：提升用户体验

---

## 四、字段分类说明

### 1. 过敏与疾病类
- **`allergies`**：食物过敏列表，JSON数组格式
- **`chronicDiseases`**：慢性疾病列表，JSON数组格式
- **`medications`**：当前用药，JSON数组，包含药品名称、用量、注意事项
- **`familyHistory`**：家族病史，用于风险评估

### 2. 生活方式类
- **`exerciseHabits`**：运动习惯描述（自由文本）
- **`exerciseFrequency`**：运动频率（枚举：`none/daily/weekly_3_4/weekly_1_2/irregular`）
- **`exerciseDuration`**：单次运动时长（分钟）
- **`exerciseTypes`**：运动类型列表（JSON数组）
- **`workRhythm`**：工作节奏（枚举：`regular_9_6/shift/irregular/freelance`）
- **`workSchedule`**：工作时间安排（JSON对象）
- **`sleepDuration`**：平均睡眠时长（小时）

### 3. 健康指标类
- **`bmi`**：身体质量指数（放在 `user_core` 表）
- **`bmr`**：基础代谢率（放在 `user_core` 表）
- **`pal`**：PAL系数（放在 `user_core` 表）
- **`waistCircumference`**：腰围（cm）
- **`bodyFatPercentage`**：体脂率（%）
- **`bloodPressure`**：血压（JSON对象）
- **`bloodSugar`**：血糖（JSON对象）

### 4. 饮食相关类
- **`dietaryRestrictions`**：饮食限制/偏好（JSON数组）
- **`foodPreferences`**：食物偏好（JSON数组）
- **`dailyCalorieNeed`**：每日所需能量（千卡）

### 5. 女性专用字段
- **`pregnancyStatus`**：生育状态（枚举：`not_pregnant/pregnant/lactating`）
- **`menstrualCycle`**：月经周期信息（JSON对象）

---

## 五、实施建议

### 阶段1：P0优先级字段（立即实施）
1. 在 `user_core` 表新增：`bmi`
2. 新建 `user_health_profile` 表，包含P0核心字段：
   - `allergies`、`chronicDiseases`
   - `exerciseHabits`、`exerciseFrequency`、`exerciseDuration`
   - `workRhythm`
   - `isCurrent`、`version` 等基础字段

### 阶段2：P1优先级字段（后续补充）
1. 在 `user_core` 表新增：`occupation`、`bmr`、`pal`
2. 在 `user_health_profile` 表新增：
   - `medications`、`dailyCalorieNeed`、`dietaryRestrictions`
   - `sleepDuration`、`familyHistory`、`notes`

### 阶段3：P2优先级字段（按需添加）
根据业务发展和用户需求，逐步添加：
- 女性专用字段（`pregnancyStatus`、`menstrualCycle`）
- 体检指标（`waistCircumference`、`bodyFatPercentage`、`bloodPressure`、`bloodSugar`）
- 食物偏好（`foodPreferences`）

---

## 六、与现有字段的关系

### 与 `user_assessments` 表的关系
- `user_assessments` 表：存储健康评估/人格画像结果（测评结果）
- `user_health_profile` 表：存储健康档案详细信息（用户主动填写/营养师录入）

两者可以相互补充：
- `user_assessments.healthConstraints` 可能包含过敏、疾病信息，但 `user_health_profile.allergies` 和 `chronicDiseases` 更详细
- `user_assessments` 是测评结果，`user_health_profile` 是档案信息

### 与 `medical_reports` 表的关系
- `medical_reports` 表：存储体检报告文件（PDF/图片）
- `user_health_profile` 表：存储结构化健康信息（文本数据）

两者可以关联：
- 体检报告中的指标可以提取到 `user_health_profile` 的相应字段
- 体检报告作为证据支撑，健康档案作为结构化数据

---

## 七、总结

### 建议新增字段统计
- **`user_core` 表新增**：4个字段（`occupation`、`bmi`、`bmr`、`pal`）
- **新建 `user_health_profile` 表**：约25个字段（按优先级分层）

### 核心价值
1. **完善健康档案**：补充前端页面已展示但数据库缺失的字段
2. **支持个性化建议**：过敏、疾病、用药等信息直接影响营养建议
3. **版本化管理**：支持用户多次更新健康档案，保留历史记录
4. **业务扩展性**：通过JSON字段和版本化设计，便于后续扩展

### 优先级建议
- **P0**：立即实施，核心功能必需
- **P1**：建议尽快补充，提升业务价值
- **P2**：按需添加，根据业务发展决定


