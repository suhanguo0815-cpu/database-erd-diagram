# 最终字段规划方案总结

## 一、总体设计原则

1. **`user_core` 表**：用户基础信息和健康档案（一对一关系）
2. **`user_assessments` 表**：健康评估/人格画像（独立表，支持版本化）

---

## 二、`user_core` 表新增字段

### 2.1 存量字段（从存量表迁移）

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 优先级 | 字段内容示例 |
|--------|------|------|----------|------|--------|------------|
| `age` | int | 32 | ❌ | 用户年龄 | P0 | `28` |
| `heightCm` | num | 53 | ❌ | 用户身高（厘米） | P0 | `170.0` |
| `initialWeightKg` | num | 53 | ❌ | 用户初始体重（kg） | P0 | `68.5` |

### 2.2 健康档案字段（新增）

#### P0优先级（核心字段，必须）
| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 字段内容示例 |
|--------|------|------|----------|------|------------|
| `allergies` | json | - | ❌ | 过敏史（食物过敏列表） | `["海鲜", "花生", "牛奶"]` |
| `chronicDiseases` | json | - | ❌ | 慢性疾病列表 | `["糖尿病", "高血压"]` |
| `medications` | json | - | ❌ | 用药情况（当前用药列表） | `[{"name": "降糖药", "dosage": "每日2次", "note": "餐后服用"}]` |
| `bmi` | num | 53 | ❌ | 身体质量指数 | `24.5` |

#### P1优先级（重要字段，建议）
| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 字段内容示例 |
|--------|------|------|----------|------|------------|
| `occupation` | str | 100 | ❌ | 职业 | `"互联网产品经理"` |
| `bmr` | num | 53 | ❌ | 基础代谢率（千卡/天） | `1450.5` |
| `pal` | num | 53 | ❌ | PAL系数（身体活动水平，1.2-2.5） | `1.6` |
| `exerciseHabits` | str | 200 | ❌ | 运动习惯描述（自由文本） | `"每周3-4次，每次30-60分钟"` |
| `exerciseFrequency` | str | 20 | ❌ | 运动频率（枚举） | `weekly_3_4` |
| `workRhythm` | str | 50 | ❌ | 工作节奏（枚举） | `regular_9_6` |

#### P2优先级（可选字段，按需）
| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 字段内容示例 |
|--------|------|------|----------|------|------------|
| `familyHistory` | json | - | ❌ | 家族病史 | `["糖尿病", "心脏病"]` |
| `dietaryRestrictions` | json | - | ❌ | 饮食限制/偏好 | `["素食", "低盐", "无麸质"]` |
| `sleepDuration` | int | 32 | ❌ | 平均睡眠时长（小时） | `7` |

---

## 三、`user_assessments` 表（保持独立）

### 表结构（已存在，保持不变）

**业务定位**：存储用户健康评估/人格画像的测评结果，支持多次测评（版本化）

**核心字段**：
- `assessmentId`、`userId`、`version`（联合主键）
- 5个因子得分：`emotionalScore`、`environmentScore`、`cognitionScore`、`agencyScore`、`metabolismScore`
- `personaName`、`healthConstraints`
- `rawResponsesJson`、`personaProfileJson`、`factorAnalysisJson`、`radarChartJson`
- `source`、`sysPlatform`、`isCurrent`
- `assessmentTimeUtc`、`create_time`、`update_time`

**设计特点**：
- ✅ 版本化设计：支持用户多次测评
- ✅ 历史记录：保留每次评估的完整数据
- ✅ 详细数据：存储完整的评估结果和原始数据

---

## 四、字段归属总结

### `user_core` 表新增字段汇总

| 类别 | 字段数量 | 优先级 |
|------|---------|--------|
| 存量字段 | 3个 | P0 |
| 健康档案核心字段 | 4个 | P0 |
| 健康档案重要字段 | 6个 | P1 |
| 健康档案可选字段 | 3个 | P2 |
| **总计** | **16个** | - |

### `user_assessments` 表

| 状态 | 说明 |
|------|------|
| **保持独立** | 不合并到 `user_core` |
| **字段数量** | 约20个字段（已存在） |
| **设计** | 版本化设计，支持历史记录 |

---

## 五、实施优先级

### 阶段1：P0优先级字段（立即实施）
1. **`user_core` 表新增存量字段**：
   - `age`、`heightCm`、`initialWeightKg`
2. **`user_core` 表新增健康档案核心字段**：
   - `allergies`、`chronicDiseases`、`medications`、`bmi`

### 阶段2：P1优先级字段（后续补充）
**`user_core` 表新增健康档案重要字段**：
- `occupation`、`bmr`、`pal`
- `exerciseHabits`、`exerciseFrequency`、`workRhythm`

### 阶段3：P2优先级字段（按需添加）
**`user_core` 表新增健康档案可选字段**：
- `familyHistory`、`dietaryRestrictions`、`sleepDuration`

---

## 六、表关系说明

```
user_core (用户基础信息 + 健康档案)
    │
    ├── 1:1 → user_preferences (用户偏好)
    ├── 1:N → user_goals (用户目标，版本化)
    ├── 1:N → user_assessments (健康评估，版本化) ⭐ 保持独立
    └── 1:N → 所有业务事实表（meals, weight, exercise等）
```

**关系说明**：
- `user_core`：用户基础信息和健康档案（一对一）
- `user_assessments`：健康评估结果（一对多，支持版本化）
- 两者通过 `userId` 关联，但保持独立

---

## 七、设计优势

### ✅ 保持独立的优势

1. **版本历史**：`user_assessments` 保留完整的历史评估记录
2. **业务分离**：基础档案与评估结果分离，逻辑清晰
3. **查询灵活**：不需要评估信息时，不查询 `user_assessments` 表
4. **扩展性好**：支持用户多次评估，查看变化趋势

### ✅ 合并健康档案到 `user_core` 的优势

1. **查询方便**：一次查询获取用户完整基础信息
2. **性能好**：基础健康信息无需额外JOIN
3. **逻辑合理**：健康档案属于用户基础属性

---

## 八、最终确认

### ✅ 确认方案

1. **`user_core` 表新增 16 个字段**：
   - 3个存量字段（P0）
   - 4个健康档案核心字段（P0）
   - 6个健康档案重要字段（P1）
   - 3个健康档案可选字段（P2）

2. **`user_assessments` 表保持独立**：
   - 不合并到 `user_core`
   - 保留版本化设计
   - 保留完整的历史记录

3. **表关系**：
   - `user_core` ←→ `user_assessments`：一对多关系（通过 `userId` 关联）

---

## 九、下一步行动

1. ✅ 更新字段清单 CSV 文件
2. ✅ 更新表关系图
3. ✅ 准备数据迁移脚本（如果有存量数据）


