# 健康档案字段合并方案分析

## 一、现有表分析

### 1. `user_core` 表（用户基础信息）
**定位**：用户基础属性，相对稳定
**已有字段**：`userId`、`nickname`、`gender`、`age`、`heightCm`、`initialWeightKg` 等
**特点**：一对一关系（每个用户一条记录）

### 2. `user_preferences` 表（用户偏好设置）
**定位**：用户偏好和设置
**已有字段**：`personality`（AI语气）、`reminders`（提醒设置）
**特点**：一对一关系（每个用户一条记录），主要用于个性化设置

### 3. `user_assessments` 表（健康评估/人格画像）
**定位**：健康评估/人格画像的测评结果
**已有字段**：`healthConstraints`（健康约束JSON，包含女性/代谢/用药）、因子得分、人格画像等
**特点**：版本化设计（支持多次测评），已经有 `healthConstraints` 字段

### 4. `user_goals` 表（用户目标）
**定位**：用户目标设置
**已有字段**：目标体重、卡路里、运动等目标值
**特点**：版本化设计，用于目标管理

---

## 二、字段分类与归属建议

### 方案A：合并到 `user_core` 表（推荐）

**适合合并的字段**（基础健康信息，相对稳定）：
- `occupation`（职业）
- `bmi`（身体质量指数）
- `bmr`（基础代谢率）
- `pal`（PAL系数）
- `allergies`（过敏史）⭐ 重要，影响营养建议
- `chronicDiseases`（慢性疾病）⭐ 重要，影响营养建议
- `medications`（用药情况）⭐ 重要，可能与食物相互作用

**优点**：
- ✅ 用户基础信息集中，查询方便（一次查询获取完整基础信息）
- ✅ 不需要额外JOIN，性能好
- ✅ 符合"基础属性"的定位

**缺点**：
- ❌ `user_core` 表字段会变多（但这些都是重要字段，可以接受）

**实施**：直接在 `user_core` 表新增字段即可

---

### 方案B：合并到 `user_assessments` 表

**适合合并的字段**（与评估结果相关的健康信息）：
- `allergies`（过敏史）
- `chronicDiseases`（慢性疾病）
- `medications`（用药情况）
- `familyHistory`（家族病史）

**优点**：
- ✅ `user_assessments` 已经有 `healthConstraints` 字段，可以扩展
- ✅ 版本化设计，支持历史记录
- ✅ 评估和档案信息相关，逻辑上合理

**缺点**：
- ❌ 评估是"测评结果"，档案是"用户填写/营养师录入"，定位略有不同
- ❌ 生活方式类字段（运动习惯、工作节奏）不太适合放在评估表

**实施**：扩展现有的 `healthConstraints` JSON字段，或新增字段

---

### 方案C：合并到 `user_preferences` 表（不推荐）

**原因**：
- ❌ `user_preferences` 是"偏好设置"（如AI语气、提醒），不是"健康档案"
- ❌ 逻辑上不合适
- ❌ 健康档案信息会影响营养建议，不能算作"偏好"

---

## 三、推荐方案：合并到 `user_core` 表

### 理由

1. **字段性质匹配**：
   - 过敏、疾病、用药等信息是用户的"基础健康属性"
   - 与 `age`、`gender`、`heightCm` 等基础信息属于同一层级

2. **查询频率高**：
   - 这些信息在生成营养建议时经常需要查询
   - 合并后一次查询即可获取，性能更好

3. **避免过度拆分**：
   - 健康档案信息相对稳定，不会频繁更新
   - 不需要版本化，一对一关系即可

4. **前端对应关系清晰**：
   - 前端 `health-profile.html` 页面展示的就是这些信息
   - 对应到 `user_core` 表，逻辑清晰

### 需要新增的字段（合并到 `user_core`）

#### P0优先级（核心字段，必须）
1. `allergies` - 过敏史（JSON数组）
2. `chronicDiseases` - 慢性疾病（JSON数组）
3. `medications` - 用药情况（JSON对象/数组）
4. `bmi` - 身体质量指数（可计算，建议存储）

#### P1优先级（重要字段，建议）
5. `occupation` - 职业
6. `bmr` - 基础代谢率
7. `pal` - PAL系数（身体活动水平）
8. `exerciseHabits` - 运动习惯描述（文本）
9. `exerciseFrequency` - 运动频率（枚举）
10. `workRhythm` - 工作节奏（枚举）

#### P2优先级（可选字段，按需）
11. `familyHistory` - 家族病史（JSON数组）
12. `dietaryRestrictions` - 饮食限制/偏好（JSON数组）
13. `sleepDuration` - 平均睡眠时长（小时）

---

## 四、字段详细设计（合并到 `user_core`）

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 字段内容示例 | 优先级 |
|--------|------|------|----------|------|------------|--------|
| `occupation` | str | 100 | ❌ | 职业 | `"互联网产品经理"` | P1 |
| `bmi` | num | 53 | ❌ | 身体质量指数 | `24.5` | P0 |
| `bmr` | num | 53 | ❌ | 基础代谢率（千卡/天） | `1450.5` | P1 |
| `pal` | num | 53 | ❌ | PAL系数（身体活动水平，1.2-2.5） | `1.6` | P1 |
| `allergies` | json | - | ❌ | 过敏史（食物过敏列表） | `["海鲜", "花生", "牛奶"]` | P0 |
| `chronicDiseases` | json | - | ❌ | 慢性疾病列表 | `["糖尿病", "高血压"]` | P0 |
| `medications` | json | - | ❌ | 用药情况（当前用药列表） | `[{"name": "降糖药", "dosage": "每日2次", "note": "餐后服用"}]` | P0 |
| `exerciseHabits` | str | 200 | ❌ | 运动习惯描述（自由文本） | `"每周3-4次，每次30-60分钟"` | P1 |
| `exerciseFrequency` | str | 20 | ❌ | 运动频率（枚举） | `weekly_3_4` | P1 |
| `workRhythm` | str | 50 | ❌ | 工作节奏（枚举） | `regular_9_6` | P1 |
| `familyHistory` | json | - | ❌ | 家族病史 | `["糖尿病", "心脏病"]` | P2 |
| `dietaryRestrictions` | json | - | ❌ | 饮食限制/偏好 | `["素食", "低盐", "无麸质"]` | P2 |
| `sleepDuration` | int | 32 | ❌ | 平均睡眠时长（小时） | `7` | P2 |

---

## 五、与 `user_assessments` 表的关系

### `user_assessments.healthConstraints` vs `user_core` 新字段

**现有 `user_assessments.healthConstraints`**：
- 来自测评问卷的回答
- 可能是简化的、结构化的约束信息
- 例如：`{"female": true, "metabolism": false, "medication": ["降糖药"]}`

**建议的 `user_core` 新字段**：
- 用户主动填写或营养师录入的详细健康档案
- 更详细、更完整的信息
- 例如：`allergies: ["海鲜", "花生"]`、`chronicDiseases: ["糖尿病", "高血压"]`

**建议**：
1. **`user_assessments.healthConstraints`** 保留，作为评估结果的简化约束
2. **`user_core` 新增详细字段**，作为完整的健康档案
3. 两者可以互相补充，评估结果可以用于快速判断，档案信息用于详细分析

---

## 六、最终推荐方案总结

### ✅ 推荐：合并到 `user_core` 表

**核心字段（P0）**：
- `allergies`、`chronicDiseases`、`medications`、`bmi`

**重要字段（P1）**：
- `occupation`、`bmr`、`pal`、`exerciseHabits`、`exerciseFrequency`、`workRhythm`

**可选字段（P2）**：
- `familyHistory`、`dietaryRestrictions`、`sleepDuration`

### 优点

1. ✅ **不需要新建表**，简化设计
2. ✅ **查询性能好**，一次查询获取完整用户信息
3. ✅ **逻辑清晰**，基础健康信息属于用户基础属性
4. ✅ **前端对应关系明确**，`health-profile.html` 对应 `user_core` 表

### 注意事项

1. **字段数量**：`user_core` 表字段会增加约10-13个，但都是重要字段，可以接受
2. **更新频率**：这些字段相对稳定，不会频繁更新，适合放在 `user_core` 表
3. **版本化需求**：如果需要保留历史记录，可以考虑增加一个 `user_health_profile_history` 表，但一般情况下不需要

---

## 七、实施建议

### 阶段1：P0优先级字段（立即实施）
在 `user_core` 表新增：
- `allergies`
- `chronicDiseases`
- `medications`
- `bmi`

### 阶段2：P1优先级字段（后续补充）
在 `user_core` 表新增：
- `occupation`、`bmr`、`pal`
- `exerciseHabits`、`exerciseFrequency`、`workRhythm`

### 阶段3：P2优先级字段（按需添加）
根据业务需求，逐步添加：
- `familyHistory`、`dietaryRestrictions`、`sleepDuration`


