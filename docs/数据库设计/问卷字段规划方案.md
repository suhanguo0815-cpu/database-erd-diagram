# 减重方案问卷字段规划方案

## 一、问卷信息分类统计

根据问卷分析，共包含 **78个题目**，分为以下10个部分：

1. **注册信息**（3题）：微信名、手机号、是否已做测评
2. **基础信息**（3题）：性别、年龄、身高
3. **五因子评估**（20题）：情绪/环境/认知/能动性/代谢因子各4题
4. **代谢疾病相关**（4题）：PCOS、确诊疾病、甲减、库欣综合征
5. **女性健康信息**（7题）：月经、生育、哺乳相关
6. **当前身体状态**（7题）：体重、腰围、臀围、历史体重、目标体重、周期
7. **健康状况**（4题）：疾病、用药情况
8. **饮食习惯**（16题）：饮食模式、安排、食物偏好、过敏等
9. **运动与生活习惯**（7题）：活动水平、运动频率、睡眠、排便等
10. **主观状态**（3题）：身体状态、头晕、熬夜、口腔溃疡等
11. **减重行为与目标**（2题）：上涨原因、改善方面

---

## 二、字段映射方案

### 1. 已存在字段（无需新增）

| 问卷题目 | 对应字段 | 归属表 | 说明 |
|---------|---------|--------|------|
| 微信名 | `nickname` | `user_core` | ✅ 已存在 |
| 手机号 | `phoneEncrypted`, `phoneMasked` | `user_core` | ✅ 已存在 |
| 性别 | `gender` | `user_core` | ✅ 已存在 |
| 年龄 | `age` | `user_core` | ✅ 已存在 |
| 身高 | `heightCm` | `user_core` | ✅ 已存在 |
| 当前体重 | `initialWeightKg` | `user_core` | ✅ 已存在（问卷时的初始体重） |
| 目标体重 | `targetWeightKg` | `user_goals` | ✅ 已存在 |
| 减重周期 | `goalCycleDays` | `user_goals` | ✅ 已存在 |
| 慢性疾病 | `chronicDiseases` | `user_core` | ✅ 已存在 |
| 用药情况 | `medications` | `user_core` | ✅ 已存在 |
| 过敏/忌口食物 | `allergies` | `user_core` | ✅ 已存在 |
| 饮食限制/偏好 | `dietaryRestrictions` | `user_core` | ✅ 已存在 |
| 运动频率 | `exerciseFrequency` | `user_core` | ✅ 已存在 |
| 运动习惯描述 | `exerciseHabits` | `user_core` | ✅ 已存在 |
| 睡眠时长 | `sleepDuration` | `user_core` | ✅ 已存在 |
| 五因子评估（20题） | `rawResponsesJson` | `user_assessments` | ✅ 已存在（原始问卷数据） |
| 代谢疾病相关 | `healthConstraints` | `user_assessments` | ✅ 已存在（pcos/diagnosed/hypot等） |

---

### 2. 需要新增的字段（`user_core` 表）

#### 2.1 身体测量数据（问卷时采集）

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 问卷来源 | 示例 |
|--------|------|------|----------|------|---------|------|
| `waistCircumferenceCm` | num | 53 | ❌ | 当前腰围（cm） | 题目39 | 85.0 |
| `hipCircumferenceCm` | num | 53 | ❌ | 当前臀围（cm） | 题目40 | 95.0 |
| `maxWeightKg` | num | 53 | ❌ | 历史最高体重（kg） | 题目41 | 80.0 |
| `minWeightKg` | num | 53 | ❌ | 历史最低体重（kg） | 题目42 | 58.0 |

#### 2.2 女性健康信息（仅女性）

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 问卷来源 | 示例 |
|--------|------|------|----------|------|---------|------|
| `menstrualRegular` | str | 20 | ❌ | 月经是否规律（regular/irregular/menopause） | 题目31 | regular |
| `hasDysmenorrhea` | bool | - | ❌ | 是否痛经 | 题目32 | true |
| `menstrualCycleDays` | int | 32 | ❌ | 月经周期天数 | 题目33 | 28 |
| `hasGivenBirth` | bool | - | ❌ | 是否已生育 | 题目34 | true |
| `postpartumMonths` | int | 32 | ❌ | 产后时间（月） | 题目35 | 6 |
| `isBreastfeeding` | bool | - | ❌ | 是否在哺乳期 | 题目36 | false |
| `feedingMethod` | str | 20 | ❌ | 喂养方式（breast/mixed/formula） | 题目37 | breast |

#### 2.3 饮食习惯详细信息

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 问卷来源 | 示例 |
|--------|------|------|----------|------|---------|------|
| `dietPattern` | str | 20 | ❌ | 饮食模式（three_meals/small_frequent/intermittent/irregular/other） | 题目49 | three_meals |
| `mealArrangement` | str | 20 | ❌ | 餐食安排方式（self_cook/delivery/canteen/mixed/other） | 题目50 | self_cook |
| `wholeGrainRatio` | bool | - | ❌ | 全谷和薯类是否占主食40%以上 | 题目51 | false |
| `legumeFrequency` | str | 20 | ❌ | 豆类频率（never/weekly_1_2/weekly_3_4/weekly_5_6/daily） | 题目52 | weekly_1_2 |
| `dairyIntakeMl` | str | 20 | ❌ | 每日奶制品摄入量（none/100_200/200_300/300_500/over_500） | 题目53 | 200_300 |
| `liverIntakeFrequency` | str | 20 | ❌ | 肝脏摄入频率（never/monthly_1_2/weekly_1_2） | 题目54 | monthly_1_2 |
| `fruitVegetableIntake` | str | 20 | ❌ | 蔬菜水果摄入量（over_500/300_500/200_300/under_200/rare） | 题目55 | 300_500 |
| `dietaryHabits` | str | 50 | ❌ | 饮食习惯（regular/vegetarian_lacto/vegetarian_strict/other） | 题目56 | regular |
| `dietaryHabitsOther` | str | 200 | ❌ | 其他饮食偏好（自由文本） | 题目58 | 低盐低脂 |
| `deepSeaFishFrequency` | bool | - | ❌ | 每周是否能吃1-2次深海鱼 | 题目60 | true |
| `tastePreference` | str | 20 | ❌ | 口味偏好（light/moderate/salty/sweet/spicy/oily） | 题目61 | light |
| `dailyWaterIntakeMl` | str | 20 | ❌ | 每日饮水量（under_1000/1000_1500/1500_2000/over_2000） | 题目62 | 1500_2000 |
| `alcoholFrequency` | str | 20 | ❌ | 饮酒频率（none/monthly_1_2/weekly_1_2/weekly_over_3） | 题目63 | monthly_1_2 |
| `supplementTypes` | json | - | ❌ | 营养素补剂类型（JSON数组） | 题目64 | ["vitaminD","calcium"] |

#### 2.4 运动与生活习惯详细信息

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 问卷来源 | 示例 |
|--------|------|------|----------|------|---------|------|
| `occupationalActivityLevel` | str | 20 | ❌ | 职业相关体力活动水平（sedentary/light/moderate/heavy） | 题目65 | sedentary |
| `exerciseDaysPerWeek` | str | 20 | ❌ | 每周运动天数（none/1_2/3_4/5_6/daily） | 题目66 | 3_4 |
| `exerciseDurationMinutes` | str | 20 | ❌ | 每次运动时长（none/under_30/30_60/60_90/over_90） | 题目67 | 30_60 |
| `exercisePreferences` | json | - | ❌ | 运动偏好（JSON数组） | 题目68 | ["aerobic","strength"] |
| `sunExposureMinutes` | str | 20 | ❌ | 每日日晒时间（none/10_20/20_30/30_60/over_60） | 题目69 | 20_30 |
| `bowelHabits` | str | 20 | ❌ | 排便情况（normal/constipation/diarrhea/irregular） | 题目71 | normal |

#### 2.5 主观状态与减重行为

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 问卷来源 | 示例 |
|--------|------|------|----------|------|---------|------|
| `selfPerceivedHealthStatus` | str | 20 | ❌ | 自评身体状态（excellent/good/fair/poor/very_poor） | 题目72 | good |
| `dizzinessFatigueFrequency` | str | 20 | ❌ | 头晕乏力频率（never/occasional/frequent/always） | 题目73 | occasional |
| `stayingUpLateFrequency` | str | 20 | ❌ | 熬夜频率（never/occasional/weekly_3_4/daily） | 题目74 | weekly_3_4 |
| `oralUlcerFrequency` | str | 20 | ❌ | 口腔溃疡频率（never/occasional/frequent） | 题目75 | occasional |
| `weightGainReasons` | json | - | ❌ | 体重上涨原因（JSON数组） | 题目76 | ["irregular_diet","lack_exercise"] |
| `pastWeightLossBehaviors` | json | - | ❌ | 过去减重行为（JSON数组） | 题目77 | ["extreme_diet","diet_pills"] |
| `improvementGoals` | json | - | ❌ | 最希望改善的方面（JSON数组，最多3个） | 题目78 | ["weight_loss","body_shape","health_indicators"] |

---

### 3. 需要更新的字段（`user_assessments` 表）

#### 3.1 `healthConstraints` 字段扩展

当前结构：`{diagnosed:[],pcos:[],hypot:[]}`

**建议扩展为：**
```json
{
  "diagnosed": ["thyroid_hypo","diabetes","pcos","cushing","other_metabolic"],
  "pcos": ["irregular_period","amenorrhea","hirsutism","acne","infertility","diagnosed"],
  "hypot": ["cold_intolerance","edema","dry_skin","fatigue","diagnosed"],
  "cushing": ["moon_face","buffalo_hump","abdominal_striae","hypertension","diagnosed"]
}
```

---

### 4. 需要新增的字段（`user_goals` 表）

问卷中"这次购买的减重周期"在创建目标时使用，但可能需要记录问卷完成时间：

| 字段名 | 类型 | 长度 | 是否非空 | 说明 | 问卷来源 | 示例 |
|--------|------|------|----------|------|---------|------|
| `questionnaireCompletedAtUtc` | timestamp | 6 | ❌ | 问卷完成时间（UTC） | - | 2024-01-15T10:00:00Z |

---

## 三、字段优先级建议

### P0 优先级（核心字段，必须）
- **身体测量**：`waistCircumferenceCm`, `hipCircumferenceCm`, `maxWeightKg`, `minWeightKg`
- **女性健康**：`menstrualRegular`, `hasGivenBirth`, `isBreastfeeding`
- **饮食习惯核心**：`dietPattern`, `mealArrangement`, `dietaryHabits`, `tastePreference`
- **运动核心**：`occupationalActivityLevel`, `exerciseDaysPerWeek`, `exerciseDurationMinutes`
- **主观状态核心**：`selfPerceivedHealthStatus`, `improvementGoals`

### P1 优先级（重要字段）
- **女性健康详细**：`hasDysmenorrhea`, `menstrualCycleDays`, `postpartumMonths`, `feedingMethod`
- **饮食习惯详细**：`wholeGrainRatio`, `legumeFrequency`, `dairyIntakeMl`, `fruitVegetableIntake`
- **生活习惯**：`sunExposureMinutes`, `bowelHabits`, `stayingUpLateFrequency`
- **减重行为**：`weightGainReasons`, `pastWeightLossBehaviors`

### P2 优先级（可选字段）
- **饮食习惯补充**：`liverIntakeFrequency`, `deepSeaFishFrequency`, `dailyWaterIntakeMl`, `alcoholFrequency`, `supplementTypes`
- **主观状态补充**：`dizzinessFatigueFrequency`, `oralUlcerFrequency`, `dietaryHabitsOther`
- **运动偏好详细**：`exercisePreferences`

---

## 四、实施建议

### 方案1：合并到 `user_core` 表（推荐）

**优点**：
- 所有用户基础信息集中管理
- 查询效率高，一次查询获取完整信息
- 与现有设计理念一致（健康档案字段已合并到 `user_core`）

**新增字段数量**：约30个字段

### 方案2：新建 `user_questionnaire` 表

**优点**：
- 与 `user_core` 解耦，结构更清晰
- 支持多次填写问卷（版本化）

**缺点**：
- 增加查询复杂度
- 需要额外的关联查询

**推荐采用方案1**，因为：
1. 问卷信息属于用户基础健康档案的一部分
2. 问卷完成相对稳定，不是频繁更新的数据
3. 现有 `user_core` 表设计已经包含了大量健康档案字段

---

## 五、字段清单（完整版）

### `user_core` 表新增字段（30个）

#### P0 优先级（14个）

**身体测量**
- `waistCircumferenceCm` - 当前腰围
- `hipCircumferenceCm` - 当前臀围
- `maxWeightKg` - 历史最高体重
- `minWeightKg` - 历史最低体重

**女性健康**
- `menstrualRegular` - 月经是否规律
- `hasGivenBirth` - 是否已生育
- `isBreastfeeding` - 是否在哺乳期

**饮食习惯**
- `dietPattern` - 饮食模式
- `mealArrangement` - 餐食安排方式
- `dietaryHabits` - 饮食习惯
- `tastePreference` - 口味偏好

**运动与生活**
- `occupationalActivityLevel` - 职业相关体力活动水平
- `exerciseDaysPerWeek` - 每周运动天数
- `exerciseDurationMinutes` - 每次运动时长

**主观状态**
- `selfPerceivedHealthStatus` - 自评身体状态
- `improvementGoals` - 改善目标（JSON数组）

#### P1 优先级（10个）

**女性健康详细**
- `hasDysmenorrhea` - 是否痛经
- `menstrualCycleDays` - 月经周期天数
- `postpartumMonths` - 产后时间（月）
- `feedingMethod` - 喂养方式

**饮食习惯详细**
- `wholeGrainRatio` - 全谷占比
- `legumeFrequency` - 豆类频率
- `dairyIntakeMl` - 奶制品摄入量
- `fruitVegetableIntake` - 蔬菜水果摄入量

**生活习惯**
- `sunExposureMinutes` - 日晒时间
- `bowelHabits` - 排便情况
- `stayingUpLateFrequency` - 熬夜频率

**减重行为**
- `weightGainReasons` - 体重上涨原因（JSON数组）
- `pastWeightLossBehaviors` - 过去减重行为（JSON数组）

#### P2 优先级（6个）

- `liverIntakeFrequency` - 肝脏摄入频率
- `deepSeaFishFrequency` - 深海鱼频率
- `dailyWaterIntakeMl` - 每日饮水量
- `alcoholFrequency` - 饮酒频率
- `supplementTypes` - 补剂类型（JSON数组）
- `exercisePreferences` - 运动偏好（JSON数组）
- `dizzinessFatigueFrequency` - 头晕乏力频率
- `oralUlcerFrequency` - 口腔溃疡频率
- `dietaryHabitsOther` - 其他饮食偏好（自由文本）

---

## 六、`user_assessments.healthConstraints` 字段扩展

**当前结构**：
```json
{
  "diagnosed": [],
  "pcos": [],
  "hypot": []
}
```

**扩展后结构**：
```json
{
  "diagnosed": ["thyroid_hypo", "diabetes", "pcos", "cushing", "other_metabolic"],
  "pcos": ["irregular_period", "amenorrhea", "hirsutism", "acne", "infertility", "diagnosed"],
  "hypot": ["cold_intolerance", "edema", "dry_skin", "fatigue", "diagnosed"],
  "cushing": ["moon_face", "buffalo_hump", "abdominal_striae", "hypertension", "diagnosed"]
}
```

---

## 七、总结

### 字段统计
- **已存在字段**：16个（已覆盖部分问卷信息）
- **需新增字段**：30个（全部在 `user_core` 表）
- **需扩展字段**：1个（`user_assessments.healthConstraints`）

### 实施步骤
1. ✅ 确认字段优先级（P0/P1/P2）
2. ✅ 更新 `user_core` 表结构（新增30个字段）
3. ✅ 扩展 `user_assessments.healthConstraints` 结构
4. ✅ 更新字段清单CSV文件
5. ✅ 更新表关系图和文档


